import{j as e,a8 as je,T as E,P as s,q as V,v as F,aw as ye,r as u,ax as ve,M as L,S as M,A as W,C as Q,D as P,L as Y,E as q,F as U,ay as be,az as Ce,ai as Te,aj as ne,B as Ae,ad as B,aA as ke,au as Se,av as De,W as Re}from"./index-5c64b3eb.js";import{I as we,C as Oe}from"./index-cd65f8ff.js";import{T as H,a as b,b as Ie,c as Pe,d as Ee,e as Le,f as Fe,g as Me}from"./TableSortLabel-f51e0cc4.js";import{U as Ne}from"./upload-file-icon-87339306.js";import{G as T,L as J,A as K,D as X}from"./useMobilePicker-ce55c032.js";import{S as Z,O as ze}from"./Select-a9ecc720.js";import{D as ee}from"./DatePicker-daece19b.js";import{T as _e}from"./TextField-1045d484.js";import{C as ae}from"./Checkbox-fa76f815.js";import{C as Ue}from"./Container-707f5a0c.js";import{C as He}from"./Card-ac720939.js";import"./isMuiElement-9d62e425.js";function oe({query:a}){return e.jsx(H,{children:e.jsx(b,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(je,{sx:{textAlign:"center"},children:[e.jsx(E,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(E,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',a,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}oe.propTypes={query:s.string};function re({emptyRows:a,height:i}){return a?e.jsx(H,{sx:{...i&&{height:i*a}},children:e.jsx(b,{colSpan:9})}):null}re.propTypes={emptyRows:s.number,height:s.number};const $e={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function We(a,i,t){return a?Math.max(0,i-t):0}function te(a,i,t){return a[t]===null?1:i[t]===null||i[t]<a[t]?-1:i[t]>a[t]?1:0}function Ye(a,i){return a==="desc"?(t,p)=>te(t,p,i):(t,p)=>-te(t,p,i)}function qe({inputData:a,comparator:i,filterName:t}){const p=a.map((l,c)=>[l,c]);return p.sort((l,c)=>{const m=i(l[0],c[0]);return m!==0?m:l[1]-c[1]}),a=p.map(l=>l[0]),t&&(a=a.filter(l=>l.employee.name.firstName.toLowerCase().indexOf(t.toLowerCase())!==-1||l.employee.name.lastName.toLowerCase().indexOf(t.toLowerCase())!==-1)),a}const se=({refetch:a,handleCloseMenu:i,setSnackbar:t})=>{const p=V(),l=F(n=>n.user.token),c=F(n=>n.user.user),[m,{data:v,error:d,isLoading:g}]=ye(),[A,h]=u.useState(!0),{data:k,error:x}=ve({token:l},{skip:A}),[o,j]=u.useState({employeeId:"Select Applicant",leaveType:"Medical Leave",fromDate:"",toDate:"",reason:"",document:null}),S=(n,y)=>{j({...o,[n]:y})},w=()=>{let n=!0;if(Object.keys(o).forEach(O=>{(o[O]===""||o[O]==="Select Applicant")&&(n=!1)}),!n){t({open:!0,mssg:"Mandatory fields can't be left empty",bgColor:p.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}});return}const y=new FormData;y.append("employeeId",o.employeeId),y.append("leaveType",o.leaveType),y.append("fromDate",U(new Date(o.fromDate),"dd/MM/yyyy")),y.append("toDate",U(new Date(o.toDate),"dd/MM/yyyy")),y.append("reason",o.reason),o.document&&y.append("document",o.document),m({token:l,body:y})},f=u.useRef(),N=()=>{f.current.click()},z=n=>{const y=n.target.files[0];y&&j({...o,document:y})},I=e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"contained",color:"primary",onClick:N,startIcon:e.jsx(Ne,{}),sx:{width:{xs:"150px",sm:"200px"}},children:"Upload Documents"}),e.jsx("input",{ref:f,type:"file",style:{display:"none"},onChange:z})]});return u.useEffect(()=>{if(x){let n="";x.status==="FETCH_ERROR"?n="Server is not responding!":n=x.data.error,t({open:!0,mssg:n,bgColor:p.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}})}},[x,p,t]),u.useEffect(()=>{if(d){let n="";d.status==="FETCH_ERROR"?n="Server is not responding!":n=d.data.error,t({open:!0,mssg:n,bgColor:p.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}})}v&&(a(),i(),t({open:!0,mssg:"Application uploaded",bgColor:p.palette.success.dark,anchorOrigin:{vertical:"top",horizontal:"right"}}))},[d,v,p,a,i,t]),u.useState(()=>{(c.role==="HR"||c.department.pseudoAdmin)&&h(!1)},[c]),e.jsxs(T,{container:!0,spacing:2,children:[e.jsx(T,{item:!0,xs:12,children:e.jsx(E,{variant:"h4",children:"Upload Application"})}),e.jsx(T,{item:!0,xs:12,children:e.jsxs(Z,{fullWidth:!0,label:"Applicant",value:o.employeeId,onChange:n=>{S("employeeId",n.target.value)},children:[e.jsx(L,{value:"Select Applicant",children:"Select Applicant"}),c.role==="HR"||c.department.pseudoAdmin?k&&k.employees.map(n=>e.jsx(L,{value:n._id,children:`${n.name.firstName} ${n.name.lastName} - ${n.employeeId}`},n._id)):e.jsx(L,{value:c._id,children:`${c.name.firstName} ${c.name.lastName} - ${c.employeeId}`})]})}),e.jsx(T,{item:!0,xs:12,children:e.jsxs(Z,{fullWidth:!0,label:"Leave Type",value:o.leaveType,onChange:n=>{S("leaveType",n.target.value)},children:[e.jsx(L,{value:"Medical Leave",children:"Medical Leave"}),e.jsx(L,{value:"Casual Leave",children:"Casual Leave"})]})}),e.jsx(T,{item:!0,xs:8,children:e.jsx(J,{dateAdapter:K,children:e.jsx(X,{components:["DatePicker"],children:e.jsx(ee,{label:"From",format:"DD/MM/YYYY",value:o.fromDate===""?null:o.fromDate,onChange:n=>S("fromDate",n)})})})}),e.jsx(T,{item:!0,xs:8,children:e.jsx(J,{dateAdapter:K,children:e.jsx(X,{components:["DatePicker"],children:e.jsx(ee,{label:"To",format:"DD/MM/YYYY",value:o.toDate===""?null:o.toDate,onChange:n=>S("toDate",n)})})})}),e.jsx(T,{item:!0,xs:12,children:e.jsx(_e,{fullWidth:!0,placeholder:"Reason",value:o.reason,onChange:n=>{S("reason",n.target.value)}})}),e.jsx(T,{item:!0,xs:3,children:o.document?e.jsxs(M,{direction:"row",gap:2,children:[e.jsx(W,{src:Q(o.document),alt:"Document"}),e.jsx(P,{onClick:()=>window.open(Q(o.document),"_blank"),children:"View"}),e.jsx(P,{onClick:()=>j({...o,document:null}),children:"Remove"})]}):I}),e.jsxs(T,{item:!0,xs:12,container:!0,justifyContent:"flex-start",spacing:2,children:[e.jsx(T,{item:!0,xs:12,sm:3,children:e.jsx(P,{variant:"contained",onClick:i,children:"Cancel"})}),e.jsx(T,{item:!0,xs:12,sm:3,children:e.jsx(Y,{variant:"contained",onClick:w,loading:g,loadingIndicator:e.jsx(q,{}),children:"Upload"})})]})]})},Ve=se;se.propTypes={refetch:s.func.isRequired,handleCloseMenu:s.func.isRequired,setSnackbar:s.func};function ie({numSelected:a,filterName:i,onFilterName:t,selected:p,setSnackbar:l,refetch:c}){const m=V(),v=F(f=>f.user.token),[d,{isLoading:g,error:A,data:h}]=be(),[k,{isLoading:x,error:o,data:j}]=Ce(),S=()=>{d({token:v,id:p})},w=()=>{k({token:v,id:p})};return u.useEffect(()=>{if(o){let f="";o.status==="FETCH_ERROR"?f="Server is not responding!":f=o.data.error,l({open:!0,mssg:f,bgColor:m.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}})}j&&(c(),l({open:!0,mssg:"Approved",bgColor:m.palette.success.dark,anchorOrigin:{vertical:"top",horizontal:"right"}}))},[j,o,m,l,c]),u.useEffect(()=>{if(A){let f="";A.status==="FETCH_ERROR"?f="Server is not responding!":f=A.data.error,l({open:!0,mssg:f,bgColor:m.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}})}h&&(c(),l({open:!0,mssg:"Approved",bgColor:m.palette.success.dark,anchorOrigin:{vertical:"top",horizontal:"right"}}))},[h,A,m,l,c]),e.jsxs(Te,{sx:{height:96,display:"flex",justifyContent:"space-between",p:f=>f.spacing(0,1,0,3),...a>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[a>0?e.jsxs(E,{component:"div",variant:"subtitle1",children:[a," selected"]}):e.jsx(ze,{value:i,onChange:t,placeholder:"Search user...",startAdornment:e.jsx(we,{position:"start",children:e.jsx(ne,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})}),a===1&&e.jsxs(M,{direction:"row",spacing:2,children:[e.jsx(Y,{disabled:g||x,loading:g||x,loadingIndicator:e.jsx(q,{}),onClick:S,children:"Approve"}),e.jsx(Y,{disabled:g||x,loading:g||x,loadingIndicator:e.jsx(q,{}),onClick:w,children:"Reject"})]})]})}ie.propTypes={numSelected:s.number,filterName:s.string,onFilterName:s.func,selected:s.string,setSnackbar:s.func,refetch:s.func};function le({order:a,orderBy:i,rowCount:t,headLabel:p,numSelected:l,onRequestSort:c,onSelectAllClick:m}){const v=d=>g=>{c(g,d)};return e.jsx(Ie,{children:e.jsxs(H,{children:[e.jsx(b,{padding:"checkbox",children:e.jsx(ae,{indeterminate:l>0&&l<t,checked:t>0&&l===t,onChange:m})}),p.map(d=>e.jsx(b,{align:d.align||"left",sortDirection:i===d.id?a:!1,sx:{width:d.width,minWidth:d.minWidth},children:e.jsxs(Pe,{hideSortIcon:!0,active:i===d.id,direction:i===d.id?a:"asc",onClick:v(d.id),children:[d.label,i===d.id?e.jsx(Ae,{sx:{...$e},children:a==="desc"?"sorted descending":"sorted ascending"}):null]})},d.id))]})})}le.propTypes={order:s.oneOf(["asc","desc"]),orderBy:s.string,rowCount:s.number,headLabel:s.array,numSelected:s.number,onRequestSort:s.func,onSelectAllClick:s.func};function ce({selected:a,employeeId:i,profilePic:t,employeeName:p,leaveType:l,from:c,to:m,reason:v,status:d,document:g,handleClick:A}){const[h,k]=u.useState(""),[x,o]=u.useState("");return u.useEffect(()=>{if(t){const j=B(t);k(j)}if(g){const j=B(g);o(j)}},[t,g]),e.jsxs(H,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[e.jsx(b,{padding:"checkbox",children:e.jsx(ae,{disableRipple:!0,checked:a,onChange:A})}),e.jsx(b,{component:"th",scope:"row",padding:"none",children:e.jsxs(M,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(W,{src:h,alt:p}),e.jsx(E,{variant:"subtitle2",noWrap:!0,children:p})]})}),e.jsx(b,{children:i}),e.jsx(b,{children:l}),e.jsx(b,{children:U(c,"dd/MM/yyyy")}),e.jsx(b,{children:U(m,"dd/MM/yyyy")}),e.jsx(b,{children:v}),e.jsx(b,{children:d}),e.jsx(b,{children:g?e.jsxs(M,{direction:"row",spacing:2,children:[e.jsx(W,{src:x,alt:"Document"}),e.jsx(P,{onClick:()=>window.open(x,"_blank"),children:"View"})]}):e.jsx(e.Fragment,{children:"No document!"})})]})}ce.propTypes={handleClick:s.func,employeeId:s.string,employeeName:s.string,profilePic:s.any,leaveType:s.string,from:s.string,to:s.string,reason:s.string,status:s.string,document:s.any,selected:s.any};function Ge(){const a=V(),i=F(r=>r.user.token),t=F(r=>r.user.user),[p,l]=u.useState([]),[c,m]=u.useState(0),[v,d]=u.useState(0),[g,A]=u.useState("asc"),[h,k]=u.useState([]),[x,o]=u.useState("employeeName"),[j,S]=u.useState(""),[w,f]=u.useState(5),[N,z]=u.useState(null),{data:I,refetch:n}=ke({token:i,page:v,rowsPerPage:w}),y={open:!1,mssg:"",bgColor:a.palette.error.dark,anchorOrigin:{vertical:"top",horizontal:"right"}},[O,$]=u.useState(y),de=(r,C)=>{C!==""&&(A(x===C&&g==="asc"?"desc":"asc"),o(C))},pe=r=>{if(r.target.checked){const C=p.map(D=>D._id);k(C);return}k([])},ue=(r,C)=>{const D=h.indexOf(C);let R=[];D===-1?R=R.concat(h,C):D===0?R=R.concat(h.slice(1)):D===h.length-1?R=R.concat(h.slice(0,-1)):D>0&&(R=R.concat(h.slice(0,D),h.slice(D+1))),k(R)},he=(r,C)=>{d(C)},me=r=>{d(0),f(parseInt(r.target.value,10))},ge=r=>{d(0),S(r.target.value)},_=qe({inputData:p,comparator:Ye(g,x),filterName:j}),xe=!_.length&&!!j,fe=r=>{z(r.currentTarget)},G=()=>{z(null)};return u.useEffect(()=>{I&&(l(I.applications),m(I.total))},[I]),e.jsxs(Ue,{children:[e.jsx(Oe,{open:O.open,mssg:O.mssg,bgColor:O.bgColor,closeSnackbar:()=>{$(y)},severity:"error",anchorOrigin:O.anchorOrigin}),e.jsxs(M,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(E,{variant:"h4",children:"Applications"}),e.jsx(P,{variant:"contained",color:"inherit",startIcon:e.jsx(ne,{icon:"eva:plus-fill"}),onClick:fe,children:"Upload Application"})]}),e.jsx(Se,{open:!!N,anchorEl:N,onClose:G,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:"450px",height:"580px",padding:"20px"}},children:e.jsx(Ve,{setSnackbar:$,refetch:n,handleCloseMenu:G})}),e.jsxs(He,{children:[t&&(t.role==="HR"||t.department.pseudoAdmin)&&e.jsx(ie,{numSelected:h.length,filterName:j,onFilterName:ge,selected:h[0],setSnackbar:$,refetch:n}),e.jsx(De,{children:e.jsx(Ee,{sx:{overflow:"unset"},children:e.jsxs(Le,{sx:{minWidth:800},children:[e.jsx(le,{order:g,orderBy:x,rowCount:_.length,numSelected:h.length,onRequestSort:de,onSelectAllClick:pe,headLabel:[{id:"employeeName",label:"Employee Name"},{id:"employeeId",label:"Employee ID"},{id:"leaveType",label:"Leave Type"},{id:"fromDate",label:"From"},{id:"toDate",label:"To"},{id:"reason",label:"Reason"},{id:"status",label:"Status"},{id:"document",label:"Document"}]}),e.jsxs(Fe,{children:[_.slice(0,w).map(r=>e.jsx(ce,{employeeId:r.employee?r.employee.employeeId:"",employeeName:r.employee?`${r.employee.name.firstName} ${r.employee.name.lastName}`:"",profilePic:r.employee?r.employee.profilePic:"",leaveType:r.leaveType,from:r.fromDate,to:r.toDate,reason:r.reason,status:r.status,document:r.document,selected:h.indexOf(r._id)!==-1,handleClick:C=>ue(C,r._id)},r._id)),e.jsx(re,{height:60,emptyRows:We(v,w,_.length)}),xe&&e.jsx(oe,{query:j})]})]})})}),e.jsx(Me,{page:v,component:"div",count:c,rowsPerPage:w,onPageChange:he,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:me})]})]})}function st(){return e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:e.jsx("title",{children:" Application | Employee Management System "})}),e.jsx(Ge,{})]})}export{st as default};
